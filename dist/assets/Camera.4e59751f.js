import{n as u,s as c}from"./index.6e2f4e66.js";var p=function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("div",{staticClass:"camera-comp"},[e("video",{directives:[{name:"show",rawName:"v-show",value:!s.photo,expression:"!photo"}],ref:"video",staticClass:"video",class:s.facingMode==="user"?"front":""}),e("div",{directives:[{name:"show",rawName:"v-show",value:s.isShowCanvas,expression:"isShowCanvas"}],staticClass:"canvas"},[e("canvas",{ref:"canva"})]),s.photo?e("div",{attrs:{id:"image_text"}},[s.photo?e("img",{staticClass:"cap-photo",attrs:{src:s.photo,alt:"photo",id:"img_prev"}}):s._e(),s._l(s.$store.state.customer.ocrResponseElements,function(a,i){return e("div",{directives:[{name:"show",rawName:"v-show",value:s.photo&&s.$store.state.customer.ocrResponseElements.length>0,expression:`
				photo &&
				$store.state.customer.ocrResponseElements.length > 0
			`}],key:i,class:a.selected?"colored-shed bounding-box":"gray-shed bounding-box",style:{top:a.y1+"px",left:a.x1+"px",width:a.x2-a.x1+"px",height:a.y2-a.y1+"px"},on:{click:function(o){return s.getSelectedElement(a)}}})})],2):s._e(),e("b-loading",{attrs:{"is-full-page":s.isFullPage,"can-cancel":!1},model:{value:s.isLoading,callback:function(a){s.isLoading=a},expression:"isLoading"}})],1)},v=[];const f={components:{},data(){return{isShowCanvas:!1,photo:null,image:null,mediaStream:null,videoDevices:[],facingMode:"environment",counter:0,switchingCamera:!1,canva:null,selectedTexts:[],isFullPage:!0,isLoading:!1,reducedSize:0,start:0,end:0,getOcrStart:0,frontImgRes:0,delayTime:3e3,count:0,checkRes:0}},mounted(){this.openCamera()},beforeDestroy(){this.closeCamera()},methods:{async openCamera(){const s=await navigator.mediaDevices.enumerateDevices();this.videoDevices=s.filter(t=>t.kind==="videoinput"),await this.StartRecording("environment")},async StartRecording(s){this.facingMode=s;let t=this.$refs.video;return t.setAttribute("autoplay",""),t.setAttribute("muted",""),t.setAttribute("playsinline",""),this.mediaStream=await navigator.mediaDevices.getUserMedia({video:{facingMode:s,width:500,height:500},audio:!1}),t.srcObject=this.mediaStream,await t.play()},ReTakePhoto(){this.photo=null,this.openCamera()},async TakePhoto(){let s=this.$refs.video;this.canva=this.$refs.canva;let t=s.videoWidth,e=s.videoHeight;this.canva.width=t,this.canva.height=e;let a=this.canva.getContext("2d");this.facingMode==="user"&&a.scale(-1,1),a.drawImage(s,0,0,t,e),a.save(),this.photo=this.canva.toDataURL("image/jpeg"),this.closeCamera(),this.start=new Date().getTime(),this.Send()},closeCamera(){const t=this.$refs.video.srcObject;if(t){const e=t.getTracks();e[0].stop(),e.forEach(a=>a.stop())}},async Send(){this.isLoading=!0;let s=new FormData;s.append("awsInstance","t2 samll"),s.append("image",this.photo),this.start=new Date().getTime(),await this.$store.dispatch("customer/getOCRDataBySchedule",s).then(t=>{if(t.status_code===200&&t.data.status===0){let e=new Date().getTime(),a=e-this.start,i=e-this.start;this.frontImgRes=i,console.log("Send to Backend and Response time => Start: "+this.start+", End: "+e+", Res time: "+a);let o={id:t.data.id};this.getOcrStart=new Date().getTime(),this.getOCRResult(o)}}).catch(t=>{this.isLoading=!1,c(t.response.data.error+"! "+t.response.data.message,"is-danger")})},getOCRResult(s){this.$store.dispatch("customer/getOCRResult",s).then(t=>{if(t.data.status!==1){let e=this;setTimeout(()=>{this.count++,this.count==1?this.delayTime=50:this.count>1&&this.delayTime>20?this.delayTime=this.delayTime-5:this.delayTime=20,e.getOCRResult(s)},this.delayTime)}else{this.delayTime=3e3,this.count=0,this.isLoading=!1,t.data.ocr_data!==null||(this.ReTakePhoto(),c("\u8A8D\u8B58\u6587\u5B57\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u518D\u5EA6\u8A66\u3059\u304B\u691C\u7D22\u6587\u5B57\u3092\u5165\u529B\u304F\u3060\u3055\u3044\u3002","is-danger"));let e={id:0,type:"ocr",photo:this.photo,ocrData:t.data.ocr_data,image:this.canva.toDataURL("image/jpeg")};this.$store.dispatch("global/setCapturedImages",e);let a=t.data.ocr_data;a.length>0?(this.$store.dispatch("customer/setOCROriginalResponse",a),this.makeBoundingBox(a)):c("\u8A8D\u8B58\u6587\u5B57\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3067\u3057\u305F\u3002\u518D\u5EA6\u8A66\u3059\u304B\u691C\u7D22\u6587\u5B57\u3092\u5165\u529B\u304F\u3060\u3055\u3044\u3002","is-danger");let i=new Date().getTime(),o=i-this.getOcrStart,r=this.frontImgRes+o;console.log("OCR Process => Start "+this.getOcrStart+", End: "+i+", Res Time: "+o),console.log(`
Total Res Time =>  `+r+`


`)}}).catch(t=>{this.isLoading=!1,c(t.response.data.error+"! "+t.response.data.message,"is-danger")})},makeBoundingBox(s){let t=[];s.forEach((e,a)=>{let i=[e.bounding_box.x1,e.bounding_box.x2,e.bounding_box.x3,e.bounding_box.x4],o=[e.bounding_box.y1,e.bounding_box.y2,e.bounding_box.y3,e.bounding_box.y4],r=i[0],l=i[0],d=o[0],h=o[0];for(let n=1;n<i.length;n++)i[n]>l?l=i[n]:i[n]<r&&(r=i[n]);for(let n=1;n<o.length;n++)o[n]>h?h=o[n]:o[n]<d&&(d=o[n]);let m={id:a,text:e.text,x1:r*.828,x2:l*.828,y1:d*.828,y2:h*.828,selected:!1};t.push(m)}),this.$store.dispatch("customer/setOCRResponseElements",t)},generateImage(){let s=document.getElementById("img_prev");var t=document.createElement("canvas"),e=t.getContext("2d");t.setAttribute("width",500),t.setAttribute("height",500),e.drawImage(s,0,0,500,500),this.$store.state.customer.ocrResponseElements.forEach((i,o)=>{e.beginPath(),e.rect(i.x1/.828,i.y1/.828,i.x2/.828-i.x1/.828,i.y2/.828-i.y1/.828),i.selected?(e.fillStyle="rgba(14, 177, 232, 0.4)",e.fill(),e.strokeStyle="#0EB1E8",e.stroke()):(e.fillStyle="rgba(255, 255, 255, 0.2)",e.fill(),e.strokeStyle="#fff",e.stroke())});let a=t.toDataURL("image/jpeg");this.$store.dispatch("customer/setBoundingBoxImage",a)},getSelectedElement(s){let t=this.$store.state.customer.ocrResponseSelectedElements.find(e=>e.id===s.id);t?(t.selected=!1,this.$store.state.customer.ocrResponseSelectedElements.splice(this.$store.state.customer.ocrResponseSelectedElements.indexOf(t),1)):(s.selected=!0,this.$store.dispatch("customer/setOCRResponseSelectedElements",s)),this.$emit("getText",this.$store.state.customer.ocrResponseSelectedElements)}}},g={};var R=u(f,p,v,!1,x,"2a1bb312",null,null);function x(s){for(let t in g)this[t]=g[t]}var y=function(){return R.exports}();export{y as c};
